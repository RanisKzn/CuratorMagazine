@using CuratorMagazineWebAPI.Models.Entities
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Mvc
@using Newtonsoft.Json
@using JsonSerializer = System.Text.Json.JsonSerializer

<div class="modal fade" aria-labelledby="signInModelLabel" aria-hidden="true" tabindex="-1" id="signInModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title">ВОЙТИ В ЛИЧНЫЙ КАБИНЕТ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <Form Model="@model"
                  OnFinish="OnFinish"
                  OnFinishFailed="OnFinishFailed"
                  LabelColSpan="8"
                  WrapperColSpan="16">
                <FormItem>
                    <Input @bind-Value="@context.Name" />
                </FormItem>
                <FormItem>
                    <InputPassword @bind-Value="@context.Password" />
                </FormItem>
                <FormItem WrapperColOffset="8" WrapperColSpan="16">
                    <Button Type="@ButtonType.Primary" HtmlType="submit" OnClick="Authorization">
                        ВОЙТИ
                    </Button>
                </FormItem>
            </Form>
        </div>
    </div>
</div>

@code {

    private User model = new User();

    private void OnFinish(EditContext editContext)
    {
        Console.WriteLine($"Success:{JsonSerializer.Serialize(model)}");
    }

    private void OnFinishFailed(EditContext editContext)
    {
        Console.WriteLine($"Failed:{JsonSerializer.Serialize(model)}");
    }

    private async void Authorization()
    {
        Console.WriteLine($"{model.Password}");

        List<User> users = new List<User>();
        using (var httpClient = new HttpClient())
        {
            using (var response = await httpClient.GetAsync("https://localhost:7217/api/User"))
            {
                string apiResponse = await response.Content.ReadAsStringAsync();
                users = JsonConvert.DeserializeObject<List<User>>(apiResponse);
            }
        }
        var temp = users;
    }
}
